# swift-gen

## Usage
### Define Thrift file
```thrift
enum Gender {
    male = 1
    female = 2
}

struct User {
    0: required i32 id
    1: required string name
    2: required string token
    3: required Gender gender
}

service LoginService {
    User login(1: required string userName, 2: required string password)
    void logout(1: required i32 userID)
}
```
### Generate codes
```shell
./thrift --clientNamespace RT --serverNamespace RTServer -i ./Services/LoginService.thrift -o ../RTSession/LoginService
```
LoginService.c.swift
```swift
//
// Code generated by thrift & swift-gen.
// Don't edit manually.
//

import Foundation
import RTSession

public enum RTGender: Int, Codable, CaseIterable {
    case male = 1
    case female = 2
    public init?(rawValue: Int) {
        switch rawValue {
        case 1:
            self = .male
        case 2:
            self = .female
        default:
            return nil
        }
    }
}

public struct RTUser: Codable {
    public let id: Int
    public let name: String
    public let token: String
    public let gender: RTGender
    public init(id: Int, name: String, token: String, gender: RTGender) {
        self.id = id
        self.name = name
        self.token = token
        self.gender = gender
    }
}

public enum LoginService {

    public static func login(userName: String, password: String) throws -> RTRequest<RTUser> {
        struct Parameter: Codable {
            let userName: String
            let password: String
        }
        return try RTRequest(
            method: "LoginService.login",
            parameter: Parameter(userName: userName, password: password),
            responseType: RTUser.self
        )
    }

    public static func logout(userID: Int) throws -> RTRequest<RTVoid> {
        struct Parameter: Codable {
            let userID: Int
        }
        return try RTRequest(
            method: "LoginService.logout",
            parameter: Parameter(userID: userID),
            responseType: RTVoid.self
        )
    }
}
```
LoginService.s.swift
```swift
//
// Code generated by thrift & swift-gen.
// Don't edit manually.
//

import Foundation
import RTSession

enum RTServerGender: Int, Codable, CaseIterable {
    case male = 1
    case female = 2
}

struct RTServerUser: Codable {
    let id: Int
    let name: String
    let token: String
    let gender: RTServerGender
}

protocol __RTLoginServiceProtocol: class {

    func login(userName: String, password: String, completion: @escaping (RTResult<RTServerUser, RTError>) -> Void)

    func logout(userID: Int, completion: @escaping (RTResult<RTVoid, RTError>) -> Void)
}

@objc(RTLoginService)
class RTLoginService: NSObject, __RTLoginServiceProtocol {

    @objc private func __login(parameter: Data, completion: @escaping (Data) -> Void) {
        struct Parameter: Codable {
            let userName: String
            let password: String
        }
        let p: Parameter
        do {
            p = try JSONDecoder().decode(Parameter.self, from: parameter)
        } catch {
            completion(RTError(code: .encodeError, errorDescription: error.localizedDescription).data)
            return
        }
        self.login(userName: p.userName, password: p.password) { result in
            completion(result.data)
        }
    }

    @objc private func __logout(parameter: Data, completion: @escaping (Data) -> Void) {
        struct Parameter: Codable {
            let userID: Int
        }
        let p: Parameter
        do {
            p = try JSONDecoder().decode(Parameter.self, from: parameter)
        } catch {
            completion(RTError(code: .encodeError, errorDescription: error.localizedDescription).data)
            return
        }
        self.logout(userID: p.userID) { result in
            completion(result.data)
        }
    }
}
```