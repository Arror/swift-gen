# swift-gen

## 使用
### 定义 Thrift 文件
```thrift
struct User {
    1: required string name
}

struct GreetingResut {
    1: required string value
}

service GreetingService {
    GreetingResut sayHallo(1: required User user, 2: required string message)
}
```
### 生成代码
```shell
./thrift -i ./Services/GreetingService.thrift -o ./Services/GreetingService
```
GreetingService.client.swift
```swift
//
// Code generated by thrift & swift-gen.
// Don't edit manually.
//

import Foundation
import RTSession

public struct RTGreetingResut: Codable {

    public let value: String

    public init(value: String) {
        self.value = value
    }
}

public struct RTUser: Codable {

    public let name: String

    public init(name: String) {
        self.name = name
    }
}

public enum GreetingService {

    public struct SayHallo: Codable {

        public let user: RTUser
        public let message: String
    }

    public static func sayHallo(user: RTUser, message: String) throws -> RTRequest<GreetingService.SayHallo, RTGreetingResut> {
        return try RTRequest(
            method: "GreetingService.sayHallo",
            parameter: GreetingService.SayHallo(user: user, message: message),
            responseType: RTGreetingResut.self
        )
    }
}
```
GreetingService.server.swift
```swift
//
// Code generated by thrift & swift-gen.
// Don't edit manually.
//

import Foundation
import RTSession

protocol __RTGreetingServiceProtocol: class {
    func sayHallo(user: RTUser, message: String, completion: @escaping (RTResult<RTGreetingResut, RTError>) -> Void)
}

@objc(RTGreetingService)
class RTGreetingService: NSObject, __RTGreetingServiceProtocol {
    @objc private func __sayHallo(parameters: Data, completion: @escaping (Data) -> Void) {
        let req = GreetingService.SayHallo.__rt_from(data: parameters)
        self.sayHallo(user: req.user, message: req.message) { result in
            completion(result.__rt_toData())
        }
    }
}

```

### 

### 组织和调用
GreetingService.server.swift 放入各自 Module 并实现协议。
```swift
extension RTGreetingService {
    func sayHallo(user: RTUser, message: String, completion: @escaping (RTResult<RTGreetingResut, RTError>) -> Void) {
        // logic
    }
}
````
GreetingService.client.swift 作为 Mediator Pod 的子 Pod 提供给调用者。
```swift
RTSession.default.invoke(request: try GreetingService.sayHallo(user: RTUser(name: "Arror"), message: "Are you OK?")) { result in
    switch result {
    case .success(let value):
        print(value)
    case .failure(let error):
        print(error)
    }
}
````